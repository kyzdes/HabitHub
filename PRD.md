# HabitHub — Product Requirements Document (PRD)

**Версия документа:** 1.0
**Дата:** 2026-02-16
**Статус:** Утвержден

---

## 1. Обзор продукта

### 1.1 Описание

HabitHub — полнофункциональное кроссплатформенное приложение для отслеживания привычек, которое помогает пользователям формировать и поддерживать полезные привычки. Приложение предоставляет удобный интерфейс для ежедневного трекинга, визуализацию прогресса, мотивационные элементы (серии, конфетти-анимации) и гибкую систему категоризации привычек.

### 1.2 Видение

Стать основным инструментом для людей, стремящихся к самосовершенствованию, благодаря простоте, красивому дизайну и мотивирующему пользовательскому опыту. HabitHub делает процесс формирования привычек приятным и наглядным.

### 1.3 Целевая аудитория

| Сегмент | Описание | Потребности |
|---------|----------|-------------|
| Студенты | 18–25 лет, хотят выстроить режим дня | Простота, мобильный доступ, напоминания |
| Профессионалы | 25–45 лет, стремятся к продуктивности | Аналитика, категории, настраиваемость |
| Люди, следящие за здоровьем | Любой возраст, фокус на ЗОЖ | Отслеживание спорта, питания, сна |
| Энтузиасты саморазвития | Мотивированные пользователи | Серии, статистика, визуализация прогресса |

### 1.4 Платформы

- **Web-приложение** (React) — основная платформа
- **iOS-приложение** (SwiftUI) — нативный мобильный клиент

---

## 2. Цели и метрики успеха

### 2.1 Бизнес-цели

| Цель | Описание |
|------|----------|
| Привлечение пользователей | Рост регистрацией через органический трафик и сарафанное радио |
| Удержание | Ежедневная вовлеченность пользователей в трекинг привычек |
| Кроссплатформенность | Бесшовный опыт между веб- и мобильной версией |

### 2.2 Ключевые метрики (KPI)

| Метрика | Целевое значение |
|---------|-----------------|
| DAU / MAU | ≥ 40% |
| Retention (D7) | ≥ 50% |
| Retention (D30) | ≥ 30% |
| Среднее кол-во привычек на пользователя | ≥ 3 |
| Среднее кол-во отметок в день | ≥ 2 |
| Средняя длина серии (streak) | ≥ 7 дней |

---

## 3. Функциональные требования

### 3.1 Аутентификация и управление аккаунтом

| ID | Требование | Приоритет |
|----|-----------|-----------|
| AUTH-01 | Регистрация по email и паролю | P0 |
| AUTH-02 | Вход по email и паролю (Passport.js LocalStrategy) | P0 |
| AUTH-03 | Выход из аккаунта | P0 |
| AUTH-04 | Сессии хранятся в PostgreSQL (TTL: 7 дней) | P0 |
| AUTH-05 | Хэширование паролей (bcryptjs) | P0 |
| AUTH-06 | Защита маршрутов — неавторизованные пользователи перенаправляются на страницу входа | P0 |
| AUTH-07 | Редактирование профиля (имя, фамилия, аватар) | P1 |
| AUTH-08 | OAuth через Google (подготовлено, не активировано) | P2 |

### 3.2 Управление привычками (CRUD)

| ID | Требование | Приоритет |
|----|-----------|-----------|
| HAB-01 | Создание привычки с названием, описанием, иконкой и цветом | P0 |
| HAB-02 | Редактирование всех полей привычки | P0 |
| HAB-03 | Удаление привычки с подтверждающим диалогом | P0 |
| HAB-04 | Архивация и разархивация привычек (мягкое удаление) | P1 |
| HAB-05 | Привязка привычки к категории | P1 |
| HAB-06 | Настройка частоты: ежедневно / еженедельно / пользовательская | P0 |
| HAB-07 | Выбор целевых дней недели (для еженедельных привычек) | P1 |
| HAB-08 | Целевое количество выполнений в день/неделю | P1 |
| HAB-09 | Настройка напоминаний (время, вкл/выкл) | P2 |
| HAB-10 | Перетаскивание (drag & drop) для изменения порядка привычек | P1 |

### 3.3 Отслеживание выполнения

| ID | Требование | Приоритет |
|----|-----------|-----------|
| CMP-01 | Отметка привычки как выполненной за текущий день | P0 |
| CMP-02 | Отмена отметки о выполнении | P0 |
| CMP-03 | Ограничение: одна отметка в день на привычку (уникальное ограничение в БД) | P0 |
| CMP-04 | Визуализация последних 7 дней выполнения на карточке привычки | P0 |
| CMP-05 | Конфетти-анимация при выполнении привычки | P1 |
| CMP-06 | Возможность добавления заметки к выполнению | P2 |
| CMP-07 | Фильтрация выполнений по диапазону дат | P1 |

### 3.4 Категории

| ID | Требование | Приоритет |
|----|-----------|-----------|
| CAT-01 | Создание категории с именем, цветом и иконкой | P0 |
| CAT-02 | Редактирование категории | P1 |
| CAT-03 | Удаление категории (привычки остаются, categoryId → null) | P0 |
| CAT-04 | Уникальность имени категории в рамках одного пользователя | P0 |
| CAT-05 | Отображение категорий как цветных бейджей на карточках привычек | P1 |
| CAT-06 | Страница управления категориями | P1 |

### 3.5 Статистика и аналитика

| ID | Требование | Приоритет |
|----|-----------|-----------|
| STAT-01 | Общее количество выполнений | P0 |
| STAT-02 | Количество активных привычек | P0 |
| STAT-03 | Количество выполнений за последние 30 дней | P1 |
| STAT-04 | Текущая серия (streak) пользователя | P0 |
| STAT-05 | Тепловая карта выполнений за неделю (WeeklyHeatmap) | P1 |
| STAT-06 | Графики выполнений (CompletionChart на Recharts) | P1 |
| STAT-07 | Фильтрация статистики по количеству дней | P1 |

### 3.6 Пользовательский интерфейс

| ID | Требование | Приоритет |
|----|-----------|-----------|
| UI-01 | Тёмная и светлая темы с переключателем | P0 |
| UI-02 | Адаптивный дизайн (мобильные устройства, планшеты, десктоп) | P0 |
| UI-03 | Навигация: Dashboard, Statistics, Profile | P0 |
| UI-04 | Пустые состояния (empty state) с призывом к действию | P1 |
| UI-05 | Toast-уведомления об успешных/неуспешных действиях | P1 |
| UI-06 | Плавные анимации и переходы (Framer Motion) | P2 |
| UI-07 | Гамбургер-меню для мобильных устройств | P1 |
| UI-08 | Аватар пользователя в навигации с выпадающим меню | P1 |

---

## 4. Нефункциональные требования

### 4.1 Производительность

| ID | Требование | Значение |
|----|-----------|----------|
| PERF-01 | Время загрузки главной страницы | < 2 секунды |
| PERF-02 | Время ответа API (P95) | < 300 мс |
| PERF-03 | Сжатие ответов (compression middleware) | Включено |
| PERF-04 | Кэширование статических файлов (Nginx) | Включено |

### 4.2 Безопасность

| ID | Требование | Реализация |
|----|-----------|------------|
| SEC-01 | Защита HTTP-заголовков | Helmet.js |
| SEC-02 | Rate limiting (общий) | 100 запросов / 15 минут |
| SEC-03 | Rate limiting (аутентификация) | 10 запросов / 15 минут |
| SEC-04 | Хэширование паролей | bcryptjs |
| SEC-05 | Валидация входных данных | Zod-схемы |
| SEC-06 | Защита от SQL-инъекций | Drizzle ORM (параметризованные запросы) |
| SEC-07 | Безопасные cookie | httpOnly, secure (production), sameSite: lax |
| SEC-08 | Файрвол (UFW) | Только порты 22, 80, 443 |
| SEC-09 | Cloudflare SSL | Origin-сертификаты |

### 4.3 Надежность и доступность

| ID | Требование | Значение |
|----|-----------|----------|
| REL-01 | Целевой аптайм | 99.5% |
| REL-02 | Менеджер процессов | PM2 (автоматический рестарт) |
| REL-03 | Каскадное удаление | FK-ограничения в БД |
| REL-04 | Миграции БД | Drizzle Kit |

### 4.4 Масштабируемость

| ID | Требование | Описание |
|----|-----------|----------|
| SCAL-01 | База данных | PostgreSQL (Neon Serverless — автомасштабирование) |
| SCAL-02 | Архитектура | Stateless сервер, сессии в БД |
| SCAL-03 | Статика | Отдается через Nginx |

---

## 5. Технический стек

### 5.1 Frontend (Web)

| Компонент | Технология |
|-----------|-----------|
| Фреймворк | React 18 + TypeScript |
| Сборка | Vite 5 |
| Стилизация | TailwindCSS 3.4 + shadcn/ui (Radix UI) |
| Управление состоянием | TanStack React Query 5 |
| Роутинг | Wouter 3 |
| Графики | Recharts 2 |
| Формы | React Hook Form + Zod |
| Анимации | Framer Motion, canvas-confetti |
| Drag & Drop | @hello-pangea/dnd |
| Иконки | Lucide React |

### 5.2 Backend

| Компонент | Технология |
|-----------|-----------|
| Runtime | Node.js (ES Modules) |
| Фреймворк | Express.js 4 |
| Язык | TypeScript 5.6 |
| ORM | Drizzle ORM 0.39 |
| БД | PostgreSQL (Neon Serverless) |
| Аутентификация | Passport.js (LocalStrategy) |
| Хранение сессий | connect-pg-simple |
| Безопасность | Helmet, express-rate-limit |
| Сборка | esbuild |

### 5.3 Mobile (iOS)

| Компонент | Технология |
|-----------|-----------|
| Платформа | iOS 16.0+ |
| UI-фреймворк | SwiftUI |
| Архитектура | MVVM |
| Сеть | URLSession (APIClient) |
| Хранение сессий | HTTP cookies |

### 5.4 Инфраструктура

| Компонент | Технология |
|-----------|-----------|
| Хостинг | VPS |
| Веб-сервер | Nginx (reverse proxy) |
| Процесс-менеджер | PM2 |
| SSL | Cloudflare Origin Certificates |
| Деплой | Автоматизированный bash-скрипт (deploy.sh) |

---

## 6. Архитектура

### 6.1 Высокоуровневая схема

```
┌──────────────┐     ┌──────────────┐     ┌──────────────────┐
│  React SPA   │────▶│    Nginx     │────▶│   Express.js     │
│  (Vite)      │     │  (reverse    │     │   API Server     │
└──────────────┘     │   proxy)     │     │   (port 5000)    │
                     └──────────────┘     └────────┬─────────┘
┌──────────────┐            │                      │
│  iOS App     │────────────┘                      │
│  (SwiftUI)   │                                   │
└──────────────┘                          ┌────────▼─────────┐
                                          │   PostgreSQL     │
                                          │   (Neon)         │
                                          └──────────────────┘
```

### 6.2 Схема базы данных

```
┌─────────────┐       ┌──────────────┐       ┌────────────────────┐
│   users      │──1:N─▶│  categories  │       │  habit_completions │
│             │       └──────┬───────┘       └─────────┬──────────┘
│  id (UUID)  │              │                         │
│  email      │       ┌──────▼───────┐                 │
│  password   │──1:N─▶│   habits     │──1:N───────────▶│
│  firstName  │       │              │                 │
│  lastName   │       │  id (UUID)   │      ┌──────────┴──────────┐
│  provider   │       │  name        │      │  id (UUID)          │
└─────────────┘       │  frequency   │      │  habitId (FK)       │
                      │  categoryId  │      │  userId (FK)        │
                      │  archived    │      │  completedDate      │
                      └──────────────┘      │  notes              │
                                            └─────────────────────┘
```

### 6.3 API-маршруты

| Метод | Путь | Описание |
|-------|------|----------|
| POST | `/api/auth/register` | Регистрация |
| POST | `/api/auth/login` | Вход |
| POST | `/api/auth/logout` | Выход |
| GET | `/api/auth/user` | Текущий пользователь |
| GET | `/api/categories` | Список категорий |
| POST | `/api/categories` | Создание категории |
| PUT | `/api/categories/:id` | Обновление категории |
| DELETE | `/api/categories/:id` | Удаление категории |
| GET | `/api/habits` | Список привычек |
| GET | `/api/habits/:id` | Получение привычки |
| POST | `/api/habits` | Создание привычки |
| PUT | `/api/habits/:id` | Обновление привычки |
| DELETE | `/api/habits/:id` | Удаление привычки |
| POST | `/api/habits/:id/archive` | Архивация |
| POST | `/api/habits/:id/unarchive` | Разархивация |
| GET | `/api/completions` | Список выполнений |
| GET | `/api/habits/:id/completions` | Выполнения привычки |
| POST | `/api/completions` | Отметить выполнение |
| DELETE | `/api/completions/:id` | Отменить выполнение |
| GET | `/api/stats` | Статистика |
| GET | `/api/health` | Health-check |

---

## 7. Пользовательские сценарии (User Flows)

### 7.1 Регистрация и первый запуск

```
Открытие приложения → Форма регистрации → Ввод email + пароль
→ Создание аккаунта → Редирект на Dashboard → Empty state
→ Кнопка "Создать первую привычку" → Модальное окно создания
→ Заполнение формы → Сохранение → Привычка на Dashboard
```

### 7.2 Ежедневный трекинг

```
Открытие Dashboard → Просмотр списка привычек → Нажатие чекбокса
→ Конфетти-анимация → Обновление тепловой карты
→ Обновление серии (streak) → Повтор для других привычек
```

### 7.3 Просмотр прогресса

```
Переход в Statistics → Просмотр общей статистики
→ Текущая серия, кол-во выполнений → Графики по дням/неделям
→ Фильтрация по периоду
```

### 7.4 Управление категориями

```
Переход в Category Settings → Список категорий с цветами
→ Создание новой категории → Ввод имени, выбор цвета и иконки
→ Сохранение → Привязка привычек к категории
```

---

## 8. Дизайн-система

### 8.1 Принципы дизайна

1. **Простота** — минимальное количество шагов для выполнения действия
2. **Мотивация** — визуальное вознаграждение за выполнение (конфетти, серии)
3. **Наглядность** — прогресс виден сразу на карточке привычки
4. **Доступность** — Radix UI обеспечивает WCAG-совместимость
5. **Адаптивность** — одинаково хорошо работает на любом экране

### 8.2 Тема

- **Тёмный режим** — основной, снижает нагрузку на глаза
- **Светлый режим** — альтернативный, переключается одной кнопкой
- **Шрифты**: Inter (UI), JetBrains Mono (цифры/статистика)
- **Скругления**: xl (12px) для карточек
- **Сетка**: 1 колонка (мобильный) → 2 (планшет) → 3 (десктоп)

### 8.3 Цветовая палитра

| Назначение | Цвет |
|-----------|------|
| Успех / Выполнено | Зелёный |
| Серия (Streak) | Янтарный |
| Опасность / Удаление | Красный |
| Графики | 5 уникальных цветов для категорий |

---

## 9. Дорожная карта (Roadmap)

### Фаза 1 — MVP (Выполнено)

- [x] Регистрация и аутентификация
- [x] CRUD привычек
- [x] Ежедневное отслеживание выполнения
- [x] Категории
- [x] Базовая статистика (серии, общее кол-во)
- [x] Тёмная/светлая тема
- [x] Адаптивный дизайн
- [x] Деплой на VPS

### Фаза 2 — Расширение (Выполнено)

- [x] iOS-приложение (SwiftUI)
- [x] Drag & drop для порядка привычек
- [x] Архивация привычек
- [x] Тепловая карта за неделю
- [x] Конфетти-анимации
- [x] Продвинутая аналитика (графики)

### Фаза 3 — Развитие (Планируется)

- [ ] OAuth (Google, Apple Sign-In)
- [ ] Push-уведомления (web + iOS)
- [ ] Экспорт данных (CSV, JSON)
- [ ] Публичные профили и социальные функции
- [ ] Android-приложение
- [ ] Виджеты для iOS (WidgetKit)
- [ ] Интеграция с Apple Health
- [ ] Групповые привычки и челленджи

### Фаза 4 — Монетизация (Планируется)

- [ ] Freemium-модель
- [ ] Премиум-аналитика и отчёты
- [ ] Кастомные темы и иконки
- [ ] Безлимитные привычки и категории
- [ ] Приоритетная поддержка

---

## 10. Ограничения и допущения

### 10.1 Ограничения

- Одна отметка о выполнении в день на привычку (по дизайну)
- Напоминания настроены, но фактическая отправка push-уведомлений не реализована
- Google OAuth подготовлен, но не активирован
- Нет оффлайн-режима для веб-версии
- iOS-приложение требует сетевого подключения

### 10.2 Допущения

- Пользователь имеет стабильное интернет-соединение
- Целевая аудитория — русско- и англоговорящие пользователи
- PostgreSQL (Neon Serverless) обеспечивает достаточную производительность для текущей нагрузки
- Cloudflare обеспечивает DDoS-защиту и CDN

---

## 11. Риски

| Риск | Вероятность | Влияние | Митигация |
|------|------------|---------|-----------|
| Потеря данных пользователей | Низкая | Критическое | Регулярные бэкапы PostgreSQL, Neon автоматические снэпшоты |
| DDoS-атака | Средняя | Высокое | Cloudflare, rate limiting, UFW |
| Утечка данных | Низкая | Критическое | Helmet, httpOnly cookies, bcrypt, валидация Zod |
| Низкое удержание пользователей | Средняя | Высокое | Мотивационные элементы (серии, конфетти), push-уведомления (фаза 3) |
| Рост нагрузки при масштабировании | Низкая | Среднее | Neon Serverless автомасштабирование, кэширование |

---

## 12. Глоссарий

| Термин | Определение |
|--------|------------|
| Привычка (Habit) | Повторяющееся действие, которое пользователь хочет отслеживать |
| Выполнение (Completion) | Отметка о выполнении привычки за конкретный день |
| Серия (Streak) | Количество последовательных дней выполнения привычки |
| Категория (Category) | Группа привычек, объединённых по тематике |
| Архивация (Archive) | Мягкое скрытие привычки без удаления данных |
| Тепловая карта (Heatmap) | Визуализация выполнений за последние 7 дней |
| Empty State | Состояние интерфейса, когда у пользователя нет данных |
